<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lista de todos os Pokemon</title>

    <!--  Link bootstrap  -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <!--  Link do Font Awesome  -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>
<body class="d-flex flex-column min-vh-100">
    <header>
        <nav class="navbar navbar-dark bg-danger px-3 justify-content-between">
            <span class="navbar-brand mb-0 h1">Pokedex</span>

            <div class="d-flex align-items-center gap-2 gap-md-3">

                <a href="readPokemon.html" class="nav-link text-white d-none d-md-block">
                    Listar um novo Pokemon
                </a>
                <a href="viewPokemon.html" class="nav-link text-white d-none d-md-block">
                    Consultar Pokemon
                </a>

                <a href="trainerData.html" class="btn btn-sm btn-info fw-bold px-3">
                    Perfil
                </a>

                <a href="" class="btn btn-sm btn-outline-light px-3" id="btn-logout">
                    Logout
                </a>
            </div>
        </nav>
    </header>

    <main class="container justify-content-center align-items-center flex-grow-1">
        <h1 class="mt-5 h2">Lista de todos os Pokemon</h1>

        <section id="section-list-pokemon">
            <ul id="content-list" class="row list-unstyled g-4"></ul>
        </section>

        <div class="d-flex justify-content-center mt-5">
            <button class="btn btn-danger mx-2" id="past-page">Voltar Página</button>
            <button id="next-page" class="btn btn-danger mx-2">Próxima Página</button>
        </div>
    </main>

    <footer class="text-center text-lg-start bg-body-tertiary text-muted">
        <section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
            <div class="me-5 d-none d-lg-block">
                <span>Conecte-se comigo nas redes sociais</span>
            </div>

            <div>
                <a href="" class="me-4 text-reset" target="_blank" aria-label="Link para rede social Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="" class="me-4 text-reset" target="_blank" aria-label="Link para rede social Github">
                    <i class="fab fa-github"></i>
                </a>
                <a href="" class="me-4 text-reset" target="_blank" aria-label="Link para rede social Linkedin">
                    <i class="fab fa-linkedin"></i>
                </a>
            </div>
        </section>

        <div class="text-center p-4 ">
            © 2025 Copyright:
            <a class="text-reset fw-bold" href="">Kayky-ctrl</a>
        </div>
    </footer>
    <script src="js/api.js"></script>

    <script>
        let currentPage = 1;
        const listElement = document.getElementById('content-list');

        async function loadPokemon(page){
            listElement.innerHTML = '<div class="text-center w-100 mt-5"><i class="fas fa-spinner fa-spin fa-3x"></i></div>'

            try{
                const response = await authFetch(`/pokemon/list?page=${page}`);

                if (!response.ok) return;

                const data = await response.json();
                renderPokemon(data.data);

                document.getElementById('past-page').disabled = !data.prev_page_url;
                document.getElementById('next-page').disabled = !data.next_page_url;
            }
            catch (error){
                console.error(error);
                listElement.innerHTML = '<p class="text-center text-danger">Erro ao carregar os Pokémon</p>'
            }
        }

        function renderPokemon(pokemon){
            listElement.innerHTML = '';
            pokemon.forEach(poke => {
                const types = poke.types.map(t => `<span class="badge bg-secondary me-1">${t.name_english}</span>`).join('')

                let imgUrl = 'https://via.placeholder.com/150';
                if (poke.image && poke.image.length > 0) imgUrl = poke.image
                console.log(poke.image)
                const html = `
                    <div class="col-12 col-md-6 col-lg-4 col-xl-3">
                        <div class="card h-100 shadow-sm border-0 rounded-4">
                            <div class="card-body text-center">
                                <img src="${poke.image.hires}" class="img-fluid mb-3" style="height: 120px; object-fit: contain;">
                                <h5 class="fw-bold text-dark">#${poke.id} ${poke.name_english}</h5>
                                <div class="mt-2">${types}</div>
                                <a href="viewPokemon.html?id=${poke.id}" class="btn btn-outline-danger btn-sm mt-3 rounded-pill px-4">Detalhes</a>
                            </div>
                        </div>
                    </div>
                `
                    listElement.insertAdjacentHTML('beforeend', html);

            });
        }
            document.getElementById('next-page').addEventListener('click', () => {
                currentPage++;
                loadPokemon(currentPage);
            });

            document.getElementById('past-page').addEventListener('click', () => {
                if (currentPage > 1){
                    currentPage--;
                    loadPokemon(currentPage);
                };
            });

            document.getElementById('btn-logout').addEventListener('click', (e) => {
                e.preventDefault();

                logout();

            });

            loadPokemon(currentPage);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
            crossorigin="anonymous"></script>
</body>
</html>