<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Busca de Pokemon</title>
</head>
<body>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

<style>
    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .type-badge {
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 1px;
        padding: 5px 15px;
        border-radius: 20px;
        color: white;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    .pokemon-img-container {
        background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, rgba(240, 240, 240, 0.5) 70%);
        border-radius: 50%;
        padding: 20px;
        transition: transform 0.3s;
    }

    .pokemon-img-container:hover {
        transform: scale(1.05);
    }
</style>
</head>

<body class="d-flex flex-column min-vh-100 bg-light">

<header>
    <nav class="navbar navbar-expand-md navbar-dark bg-danger px-3 shadow-sm">
        <span class="navbar-brand mb-0 h1 fw-bold"><i class="fas fa-gamepad me-2"></i>Pokedex Manager</span>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menuNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse justify-content-end" id="menuNavbar">
            <ul class="navbar-nav align-items-center gap-2">
                <li class="nav-item"><a href="dashboard.html" class="nav-link text-white">Dashboard</a></li>
                <li class="nav-item"><a href="readPokemon.html"
                                        class="btn btn-sm btn-dark bg-opacity-25 border-0 text-white fw-bold px-3">Listar um novo pokémon</a>
                </li>
                <li class="nav-item"><a href="trainerData.html" class="nav-link text-white">Perfil</a></li>
                <li class="nav-item"><a href="" class="btn btn-outline-light btn-sm px-3">Sair</a></li>
            </ul>
        </div>
    </nav>
</header>

<main class="container my-5 flex-grow-1">

    <div class="row justify-content-center mb-5">
        <div class="col-md-8 col-lg-6 text-center">
            <h2 class="fw-bold mb-3 text-secondary">Qual Pokémon você procura?</h2>
            <div class="input-group input-group-lg shadow-sm">
                <input type="text" id="searchInput" class="form-control border-0"
                       placeholder="Digite o nome ou número (ex: pikachu, 25)...">
                <button class="btn btn-danger px-4" type="button" onclick="searchPokemon()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="loadingSpinner" class="text-center d-none">
        <div class="spinner-border text-danger" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted">Buscando dados na PokéAPI...</p>
    </div>

    <div id="errorMessage" class="alert alert-warning text-center d-none shadow-sm" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i> Pokémon não encontrado! Verifique o nome e tente novamente.
    </div>

    <div id="pokemonCard" class="row justify-content-center d-none fade-in">
        <div class="col-lg-10">
            <div class="card border-0 shadow-lg overflow-hidden rounded-4">
                <div class="row g-0">

                    <div class="col-md-5 bg-danger bg-gradient d-flex flex-column align-items-center justify-content-center p-5 text-white position-relative">
                        <i class="fas fa-certificate position-absolute text-white opacity-25"
                           style="font-size: 15rem; z-index: 0;"></i>

                        <div class="pokemon-img-container position-relative" style="z-index: 1;">
                            <img id="pokeImage" src="" alt="Pokemon" class="img-fluid"
                                 style="height: 200px; width: 200px; object-fit: contain;">
                        </div>

                        <h2 class="mt-4 fw-bold text-capitalize position-relative" style="z-index: 1;" id="pokeName">
                            Nome</h2>
                        <span class="badge bg-dark bg-opacity-50 px-3 py-2 rounded-pill position-relative"
                              style="z-index: 1;" id="pokeId">#000</span>

                        <div class="mt-3 d-flex gap-2 position-relative" style="z-index: 1;" id="pokeTypes">
                        </div>
                    </div>

                    <div class="col-md-7 p-4 p-md-5 bg-white">

                        <div class="row text-center mb-4">
                            <div class="col-4 border-end">
                                <h5 class="fw-bold mb-0" id="pokeHeight">0 m</h5>
                                <small class="text-muted text-uppercase">Altura</small>
                            </div>
                            <div class="col-4 border-end">
                                <h5 class="fw-bold mb-0" id="pokeWeight">0 kg</h5>
                                <small class="text-muted text-uppercase">Peso</small>
                            </div>
                            <div class="col-4">
                                <h5 class="fw-bold mb-0 text-capitalize" id="pokeAbility">---</h5>
                                <small class="text-muted text-uppercase">Habilidade</small>
                            </div>
                        </div>

                        <h5 class="text-secondary border-bottom pb-2 mb-3"><i class="fas fa-chart-bar me-2"></i>Status
                            Base</h5>

                        <div class="mb-2">
                            <div class="d-flex justify-content-between">
                                <small class="fw-bold">HP</small>
                                <small id="val-hp">0</small>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div id="bar-hp" class="progress-bar bg-success" role="progressbar"
                                     style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="mb-2">
                            <div class="d-flex justify-content-between">
                                <small class="fw-bold">Attack</small>
                                <small id="val-atk">0</small>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div id="bar-atk" class="progress-bar bg-danger" role="progressbar"
                                     style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="mb-2">
                            <div class="d-flex justify-content-between">
                                <small class="fw-bold">Defense</small>
                                <small id="val-def">0</small>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div id="bar-def" class="progress-bar bg-primary" role="progressbar"
                                     style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="mb-2">
                            <div class="d-flex justify-content-between">
                                <small class="fw-bold">Speed</small>
                                <small id="val-spd">0</small>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div id="bar-spd" class="progress-bar bg-warning" role="progressbar"
                                     style="width: 0%"></div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

</main>

<footer class="text-center text-lg-start bg-body-tertiary text-muted mt-auto">
    <section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
        <div class="me-5 d-none d-lg-block">
            <span>Conecte-se comigo nas redes sociais</span>
        </div>
        <div>
            <a href="" class="me-4 text-reset text-decoration-none"><i class="fab fa-instagram"></i></a>
            <a href="" class="me-4 text-reset text-decoration-none"><i class="fab fa-github"></i></a>
            <a href="" class="me-4 text-reset text-decoration-none"><i class="fab fa-linkedin"></i></a>
        </div>
    </section>
    <div class="text-center p-4">
        © 2025 Copyright: <a class="text-reset fw-bold" href="">Kayky-ctrl</a>
    </div>
</footer>

<script src="js/api.js"></script>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const initialId = urlParams.get('id');

    if (initialId){
        document.getElementById('searchInput').value = initialId;
        searchPokemon(initialId);
    }

    async function searchPokemon(idOverride = null){
        const inputVal = idOverride || document.getElementById('searchInput').value;
        const spinner = document.getElementById('loadingSpinner');
        const card = document.getElementById('pokemonCard');
        const errorMsg = document.getElementById('errorMessage');

        if (!inputVal || isNaN(inputVal)){
            alert('Por favor, digite um valor de ID valido (ex: 25)');
            return
        }

        spinner.classList.remove('d-none');
        card.classList.add('d-none');
        errorMsg.classList.add('d-none');

        try {
            const response = await authFetch(`/pokemon/view`, {
                method: 'POST',
                body: JSON.stringify({id: parseInt(inputVal)})
            });

            if (!response.ok) throw new Error('Pokemon não encontrado');

            const poke = await response.json();
            fillPokemonData(poke);

            spinner.classList.add('d-none');
            card.classList.remove('d-none');
            card.classList.add('fade-in');

        }
        catch (error){
            spinner.classList.add('d-none');
            errorMsg.classList.remove('d-none');
        }
    }

    function fillPokemonData(poke){
        document.getElementById('pokeName').textContent = poke.name_english;
        document.getElementById('pokeId').textContent = `#${poke.pokedex_id || poke.id}`;

        let imgUrl = poke.image;
        document.getElementById('pokeImage').src = poke.image.hires;

        const typesdiv = document.getElementById('pokeTypes');

        typesdiv.innerHTML = poke.types.map(t =>
            `<span class="badge bg-secundary type-badge">${t.name_english}</span>`
        ).join('');

        const stats = poke.base || {};

        updateStat('hp', stats['HP'] || 0);
        updateStat('atk', stats['Attack'] || 0);
        updateStat('def', stats['Defense'] || 0);
        updateStat('spd', stats['Speed'] || 0);

        const profile = poke.profile || {};
        document.getElementById('pokeHeight').textContent = profile.height || '---';
        document.getElementById('pokeWeight').textContent = profile.weight || '---';
        document.getElementById('pokeAbility').textContent = profile.ability ? profile.ability[0] : '---';
    }

    function updateStat(id, value) {
        document.getElementById(`val-${id}`).textContent = value;
        const percent = Math.min((value / 255) * 100, 100);
        document.getElementById(`bar-${id}`).style.width = `${percent}%`;
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

</body>
</html>